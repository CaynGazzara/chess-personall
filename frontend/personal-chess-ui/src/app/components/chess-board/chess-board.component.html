<div class="chess-game">
  <div class="game-header">
    <h2>Xadrez Personalizado</h2>
    <div class="game-info">
      <span>Jogador atual: {{ getPieceColorDisplay(currentPlayer) }}</span>
      <span>Estado do jogo: {{
        gameState === 'Check' ? 'Rei em Cheque' :
        gameState === 'WhiteWon' ? 'Brancas Venceram' :
        gameState === 'BlackWon' ? 'Pretas Venceram' :
        gameState === 'Stalemate' ? 'Afogamento' :
        gameState === 'Draw' ? 'Empate' :
        gameState
        }}</span>
    </div>

    <div class="game-controls">
      <button (click)="resetGame()" class="reset-btn" [disabled]="gameState === 'InProgress' || gameState === 'Check'">
        ♻️ Reiniciar Jogo
      </button>

      <button (click)="loadBoard()" class="refresh-btn">
        🔄 Atualizar
      </button>
    </div>
  </div>

  <div class="chess-board">
    <div *ngFor="let row of board; let i = index" class="board-row">
      <div *ngFor="let piece of row; let j = index"
        [class.selected]="selectedPiece && selectedPiece.position.rank === i && selectedPiece.position.file === j"
        [class.possible-move]="isPossibleMove(i, j)"
        [class.invalid-move]="selectedPiece && !isPossibleMove(i, j) && (i !== selectedPiece.position.rank || j !== selectedPiece.position.file)"
        class="board-square" [class.light]="(i + j) % 2 === 0" [class.dark]="(i + j) % 2 !== 0"
        (click)="onSquareClick(i, j)">

        <span class="coordinate" *ngIf="j === 0">{{ 8 - i }}</span>
        <span class="coordinate" *ngIf="i === 7">{{ getFileLetter(j) }}</span>

        <div *ngIf="piece" class="piece-container">
          <img *ngIf="getPieceImage(piece) as src" [src]="src" [alt]="piece.type" class="chess-piece">
          <div class="piece-debug"
            *ngIf="selectedPiece && selectedPiece.position.rank === i && selectedPiece.position.file === j">
            ✓
          </div>
        </div>

        <div class="move-indicator" *ngIf="isPossibleMove(i, j)">●</div>
      </div>
    </div>
  </div>

  <div class="debug-info" *ngIf="selectedPiece">
    <h3>Informações de Debug:</h3>
    <p>Peça selecionada: {{ selectedPiece.piece.type }} ({{ selectedPiece.piece.color }})</p>
    <p>Posição: linha {{ selectedPiece.position.rank }}, coluna {{ selectedPiece.position.file }}</p>
    <p>Movimentos possíveis: {{ possibleMoves.length }}</p>
  </div>

  <div class="game-status-message" [class.status-check]="gameState === 'Check'"
    [class.status-checkmate]="gameState === 'WhiteWon' || gameState === 'BlackWon'"
    [class.status-draw]="gameState === 'Draw' || gameState === 'Stalemate'">

    <span *ngIf="gameState === 'Check'">⚠️ Rei em cheque! Jogador atual deve se defender.</span>
    <span *ngIf="gameState === 'WhiteWon'">🎉 Xeque-mate! Brancas venceram!</span>
    <span *ngIf="gameState === 'BlackWon'">🎉 Xeque-mate! Pretas venceram!</span>
    <span *ngIf="gameState === 'Draw'">🤝 Empate!</span>
    <span *ngIf="gameState === 'Stalemate'">🤝 Afogamento! Empate por afogamento do rei.</span>
  </div>


  <div class="game-status-message" [class.status-check]="gameState === 'Check'"
    [class.status-checkmate]="gameState === 'WhiteWon' || gameState === 'BlackWon'"
    [class.status-draw]="gameState === 'Draw' || gameState === 'Stalemate'">

    <span *ngIf="gameState === 'Check'">⚠️ Rei em cheque!</span>
    <span *ngIf="gameState === 'WhiteWon'">🎉 Brancas venceram!</span>
    <span *ngIf="gameState === 'BlackWon'">🎉 Pretas venceram!</span>
    <span *ngIf="gameState === 'Draw'">🤝 Empate!</span>
    <span *ngIf="gameState === 'Stalemate'">🤝 Afogamento!</span>
  </div>
</div>